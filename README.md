# NestJS Demo

## Table of Contents

[Introduction](#introduction)  
[Getting Started](#getting-started)  
[Possible Improvements](#possible-improvements)  

## Introduction

- This is a simple fullstack NestJS + React demo application. It demonstrates the use of NestJS with TypeScript and includes a basic REST API for Order flow management. The application is structured using the NestJS module system and follows best practices for building scalable and maintainable applications.

- The backend includes two endpoints for listing, creating, updating, and deleting Properties and Orders.

- You can test the whole API (for example, list Properties after placing the orders to see how number of available pieces changes) using the Swagger UI, which is automatically generated by NestJS based on provided API decorators. The API is built with TypeScript and uses decorators to define routes and middleware.

- For the sake of simplicity, only the Order flow is implemented on the frontend. The application allows users to place orders for properties, and the number of available pieces is updated accordingly.

- The app uses a global error handler to catch and log errors and uses the `class-validator` library to validate incoming requests.

- The application uses PostgreSQL (with TypeORM as an ORM) as the database, containerized using Docker.

- The environment variables for the database connection are stored in a `.env` file, which is included in the repository since it's a demo application. In a production application, you would want to use a more secure method of storing environment variables.

- The frontend is built with React and Vite and communicates with the backend API to place orders.

- The frontend uses only a subset of the backend API: a single Order page with an Order Form where users can enter a property ID and the quantity of pieces to purchase. Upon submission, an order is created (if the input data is valid), and a success or error message is displayed in the UI and browser console.

- Two simple GitHub workflows run either backend tests and linter and or frontend linter on every git push and PR raised, when a file in a corresponding folder changes.

## Getting Started

This guide explains how to run the PostgreSQL database, seed it with sample data, and start the NestJS backend.

### Prerequisites

- [Docker](https://www.docker.com/products/docker-desktop/)
- [Node.js](https://nodejs.org/en) `v22.14.0` (required)
- [`npm`](https://www.npmjs.com/)

Install backend and frontend dependencies. Note: the backend requires Node.js v22.14.0 (can be installed with NVM).

From the project root directory, run the following commands:

```bash
cd backend
npm install
```

```bash
cd frontend
npm install
```

### 1. Start PostgreSQL with Docker

From the project root directory, run the following command to start the PostgreSQL database using Docker:

```bash
docker compose up -d
```

This starts a PostgreSQL container exposed on port 5433.

### 2. Seed the Database

This will create all tables and insert 10 sample properties.

```bash
cd backend
npm run db:seed
```

### 3. Run the NestJS Backend

From the project root directory, run the following commands:

```bash
cd backend
npm run start:dev
```

The API will be available at:

http://localhost:3000

Swagger docs (for testing the endpoints) will be available at:

http://localhost:3000/api

### 4. Run the React Frontend

From the project root directory, run the following commands:

```bash
cd frontend
npm run dev
```

Open http://localhost:5173 to access the Order page with the Order form.

You can enter the property ID and quantity, submit the form, and view success or error messages in the UI and console.

### 5. Connect to the Database (Optional)

You can inspect the PostgreSQL database manually using the `psql` CLI:

```bash
psql -h localhost -p 5433 -U postgres -d nestjs_demo
```

Password:

```text
postgres
```

Useful SQL commands:

```bash
\dt                         # List all tables
SELECT * FROM property;     # View all properties
SELECT * FROM "order";      # View all orders (note: "order" is a reserved keyword, so must be in quotes)
```

To exit the psql prompt:

```bash
\q
```

## Possible Improvements

- **Use the full Properties and Orders API in the frontend**
- **Add more frontend features:**
  - Display a list of properties with live availability/sold stats
  - Property detail pages with:
    - Investment stats
    - Pie chart of sold/available
    - Ability to place an order directly from the property detail page
  - Filtering and sorting (by price, pieces, etc.)
  - Show order history
  - Add a map with property locations
  - Use form validation (e.g. with Zod instead of browser validation)
  - Live availability check before submitting:
    - Warn if too many pieces selected
    - Limit input based on availability
  - Disable form while submitting + all loading states
- **Backend improvements:**
  - Add validation for max values (not just min values)
  - Add validation for updating orders (whether the property associated with the order still exists or is available and whether increasing the quantity exceeds available property pieces). For now, I've just added a warning comment in the code.
  - Support updating hidden properties by allowing optional retrieval (e.g. `showHidden=true`) in GET endpoints to make it possible to change their status via the API
  - Add user authentication and authorization
  - Associate orders with users
- **Testing:**
  - Add frontend unit, snapshot, and integration tests
  - Add backend integration and E2E tests
- **Admin features:**
  - Add an admin dashboard to manage users, properties, and orders
